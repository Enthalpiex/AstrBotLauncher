# 📚 7G PDF批量处理指南

## 🚀 快速开始

### 1. 安装依赖
```bash
python install_dependencies.py
```

### 2. 批量处理PDF
```bash
# 基本用法
python batch_knowledge_processor.py /path/to/your/pdf/directory

# 自定义知识库名称
python batch_knowledge_processor.py /path/to/your/pdf/directory --kb-name "航天知识库"

# 仅提取文本（更快）
python batch_knowledge_processor.py /path/to/your/pdf/directory --text-only
```

## 📋 功能特点

### ✅ 自动分割大文件
- 自动检测超过50MB的PDF文件
- 按页数分割（默认50页/文件）
- 避免上传超时问题

### ✅ 并发处理
- 支持多文件并发上传
- 可调节并发数量（默认3个）
- 提高处理速度

### ✅ 智能处理
- 自动登录AstrBot管理面板
- 自动创建知识库
- 自动选择Embedding提供商

### ✅ 错误处理
- 文件处理失败自动跳过
- 详细的错误日志
- 支持断点续传

## 🛠️ 高级用法

### 1. 自定义分割设置
```bash
# 每个文件100页
python batch_knowledge_processor.py /path/to/pdfs --max-pages 100

# 并发5个文件
python batch_knowledge_processor.py /path/to/pdfs --max-concurrent 5
```

### 2. 自定义AstrBot地址
```bash
# 如果AstrBot运行在其他地址
python batch_knowledge_processor.py /path/to/pdfs --astrbot-url "http://192.168.1.100:6185"
```

### 3. 自定义登录信息
```bash
# 使用不同的用户名和密码
python batch_knowledge_processor.py /path/to/pdfs --username "admin" --password "your_password"
```

## 📊 处理策略

### 方案一：直接上传（推荐）
```bash
python batch_knowledge_processor.py /path/to/pdfs --kb-name "完整知识库"
```
**优点**：保持PDF格式，支持图片和表格
**缺点**：处理时间较长

### 方案二：文本提取（快速）
```bash
python batch_knowledge_processor.py /path/to/pdfs --text-only --kb-name "文本知识库"
```
**优点**：处理速度快，文件小
**缺点**：丢失图片和格式信息

### 方案三：混合处理
```bash
# 先提取文本
python batch_knowledge_processor.py /path/to/pdfs --text-only --kb-name "快速知识库"

# 再上传重要PDF
python batch_knowledge_processor.py /path/to/important_pdfs --kb-name "完整知识库"
```

## 🔧 性能优化

### 1. 硬件要求
- **内存**：建议8GB以上
- **存储**：确保有足够空间存储分割文件
- **网络**：稳定的网络连接

### 2. 参数调优
```bash
# 高配置机器
python batch_knowledge_processor.py /path/to/pdfs --max-concurrent 10 --max-pages 100

# 低配置机器
python batch_knowledge_processor.py /path/to/pdfs --max-concurrent 1 --max-pages 20
```

### 3. 分批处理
```bash
# 将PDF按类别分目录
/pdfs/
  ├── 技术文档/
  ├── 用户手册/
  └── 研究报告/

# 分别处理
python batch_knowledge_processor.py /pdfs/技术文档 --kb-name "技术文档库"
python batch_knowledge_processor.py /pdfs/用户手册 --kb-name "用户手册库"
```

## 🚨 注意事项

### 1. 文件准备
- 确保PDF文件可正常打开
- 检查文件编码（建议UTF-8）
- 避免损坏的PDF文件

### 2. 网络稳定
- 处理过程中保持网络连接
- 建议使用有线网络
- 避免网络中断

### 3. 存储空间
- 确保有足够空间存储临时文件
- 处理完成后会自动清理临时文件
- 建议预留2倍PDF大小的空间

## 📈 预估时间

### 7G PDF处理时间预估
- **文本提取**：30-60分钟
- **直接上传**：2-4小时
- **网络上传**：取决于网络速度

### 优化建议
1. 先运行`--text-only`测试
2. 根据结果调整参数
3. 分批处理大文件

## 🔍 故障排除

### 常见问题

#### 1. 登录失败
```bash
# 检查AstrBot是否运行
curl http://localhost:6185/api/auth/login

# 检查用户名密码
python batch_knowledge_processor.py /path/to/pdfs --username "Germania" --password "your_password"
```

#### 2. 文件上传失败
```bash
# 检查文件大小
ls -lh /path/to/pdfs/*.pdf

# 减小分割页数
python batch_knowledge_processor.py /path/to/pdfs --max-pages 20
```

#### 3. 内存不足
```bash
# 减少并发数
python batch_knowledge_processor.py /path/to/pdfs --max-concurrent 1

# 使用文本提取模式
python batch_knowledge_processor.py /path/to/pdfs --text-only
```

## 🎯 最佳实践

### 1. 预处理
```bash
# 检查PDF文件
find /path/to/pdfs -name "*.pdf" -exec pdfinfo {} \;

# 清理损坏文件
find /path/to/pdfs -name "*.pdf" -exec sh -c 'if ! pdfinfo "$1" >/dev/null 2>&1; then echo "损坏: $1"; fi' _ {} \;
```

### 2. 分批处理
```bash
# 按文件大小分批
find /path/to/pdfs -name "*.pdf" -size +100M -exec mv {} /path/to/large_pdfs/ \;
find /path/to/pdfs -name "*.pdf" -size -100M -exec mv {} /path/to/small_pdfs/ \;

# 分别处理
python batch_knowledge_processor.py /path/to/small_pdfs --kb-name "小文件库"
python batch_knowledge_processor.py /path/to/large_pdfs --kb-name "大文件库"
```

### 3. 监控进度
```bash
# 查看处理日志
tail -f batch_processing.log

# 检查知识库状态
curl -H "Authorization: Bearer $TOKEN" http://localhost:6185/api/plug/alkaid/kb/collections
```

## 🎉 完成后的使用

### 1. 在聊天中使用
```bash
/kb 查询内容    # 查询知识库
/kb list        # 查看知识库列表
```

### 2. 管理知识库
- 访问：http://localhost:6185
- 进入：Alkaid → 知识库
- 管理：查看、编辑、删除知识库

### 3. 优化查询
- 调整检索参数
- 优化提示词
- 监控查询效果 