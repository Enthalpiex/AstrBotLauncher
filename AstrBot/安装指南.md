# 📚 AstrBot知识库插件安装指南

## 🚀 前置要求

### 1. 安装知识库插件
```bash
# 方法一：通过pip安装
pip install astrbot_plugin_knowledge_base

# 方法二：从GitHub安装最新版本
pip install git+https://github.com/lxfight/astrbot_plugin_knowledge_base.git
```

### 2. 配置Embedding提供商
在AstrBot管理面板中配置至少一个Embedding提供商：

1. 访问：http://localhost:6185
2. 进入：配置 → 提供商管理
3. 添加Embedding提供商（如您已配置的"PPIO baai"）

### 3. 启用插件
1. 访问：http://localhost:6185
2. 进入：插件管理
3. 找到 `astrbot_plugin_knowledge_base` 并启用

## 🔧 安装批量处理工具

### 1. 安装依赖
```bash
python install_dependencies.py
```

### 2. 验证安装
```bash
# 检查插件是否正常工作
python batch_knowledge_processor_v2.py /path/to/test/pdfs --text-only
```

## 📋 插件功能对比

| 功能 | 原插件 | 批量处理工具 |
|------|--------|--------------|
| **单个文件上传** | ✅ 支持 | ✅ 支持 |
| **批量文件上传** | ❌ 不支持 | ✅ 支持 |
| **大文件分割** | ❌ 不支持 | ✅ 自动分割 |
| **并发处理** | ❌ 不支持 | ✅ 并发上传 |
| **文本提取** | ✅ 支持 | ✅ 支持 |
| **进度显示** | ❌ 不支持 | ✅ 实时进度 |

## 🎯 使用流程

### 步骤1：安装插件
```bash
pip install astrbot_plugin_knowledge_base
```

### 步骤2：配置AstrBot
1. 重启AstrBot
2. 在管理面板中启用插件
3. 配置Embedding提供商

### 步骤3：批量处理PDF
```bash
# 基本用法
python batch_knowledge_processor_v2.py /path/to/your/7g_pdfs --kb-name "航天知识库"

# 快速文本提取
python batch_knowledge_processor_v2.py /path/to/your/7g_pdfs --text-only --kb-name "快速知识库"
```

### 步骤4：使用知识库
```bash
# 在聊天中使用
/kb use 航天知识库    # 激活知识库
/kb 查询内容          # 查询知识库
/kb list             # 查看所有知识库
```

## 🔍 插件特性

### ✅ 支持的文件格式
- **PDF** (.pdf)
- **Word文档** (.docx)
- **Markdown** (.md)
- **纯文本** (.txt)

### ✅ 支持的Embedding模型
- **OpenAI** (text-embedding-ada-002)
- **智谱AI** (text-embedding-v1)
- **百度文心** (embedding-v1)
- **PPIO baai** (您已配置的模型)
- **本地模型** (Ollama等)

### ✅ 向量数据库
- **FAISS** (默认，高性能)
- **Chroma** (可选)
- **Pinecone** (云服务)

## 🚨 重要注意事项

### 1. 插件兼容性
- 确保AstrBot版本 >= 3.4.0
- 插件版本 >= v0.5.7 (支持LRU缓存优化)

### 2. 内存优化
- 新版本支持LRU缓存，自动管理内存
- 旧版Faiss文件需要重新生成才能享受优化

### 3. 数据安全
- 删除操作不可逆，请谨慎操作
- 建议定期备份知识库数据

## 🔧 故障排除

### 问题1：插件未找到
```bash
# 检查插件是否安装
pip list | grep knowledge_base

# 重新安装
pip uninstall astrbot_plugin_knowledge_base
pip install astrbot_plugin_knowledge_base
```

### 问题2：Embedding提供商未配置
1. 检查AstrBot管理面板 → 提供商管理
2. 确保至少有一个Embedding提供商已启用
3. 重启AstrBot

### 问题3：API接口错误
```bash
# 检查AstrBot是否运行
curl http://localhost:6185/api/auth/login

# 检查插件API
curl http://localhost:6185/api/plugin/list
```

### 问题4：内存不足
```bash
# 减少并发数
python batch_knowledge_processor_v2.py /pdfs --max-concurrent 1

# 使用文本模式
python batch_knowledge_processor_v2.py /pdfs --text-only
```

## 📊 性能对比

### 7G PDF处理时间预估

| 方法 | 时间 | 内存占用 | 优点 | 缺点 |
|------|------|----------|------|------|
| **手动上传** | 8-12小时 | 低 | 稳定 | 极慢 |
| **批量工具** | 2-4小时 | 中 | 快速 | 需要配置 |
| **文本提取** | 30-60分钟 | 低 | 最快 | 丢失格式 |

### 优化建议
1. **高配置机器**：使用 `--max-concurrent 10`
2. **低配置机器**：使用 `--max-concurrent 1 --text-only`
3. **网络不稳定**：分批处理，使用 `--max-pages 20`

## 🎉 完成后的管理

### 1. 知识库管理
```bash
/kb list          # 查看所有知识库
/kb use 知识库名    # 激活知识库
/kb search 内容    # 搜索知识库
/kb delete 知识库名 # 删除知识库（管理员）
```

### 2. 数据迁移
```bash
# 旧版本数据迁移
/kb migrate
```

### 3. 性能监控
- 监控内存使用情况
- 检查向量数据库大小
- 定期清理无用数据

## 💡 最佳实践

### 1. 文件组织
```
/pdfs/
  ├── 技术文档/     # 按类别分类
  ├── 用户手册/
  └── 研究报告/
```

### 2. 分批处理
```bash
# 按大小分批
python batch_knowledge_processor_v2.py /pdfs/小文件 --kb-name "小文件库"
python batch_knowledge_processor_v2.py /pdfs/大文件 --kb-name "大文件库"
```

### 3. 定期备份
- 备份原始PDF文件
- 备份知识库数据
- 记录处理日志

## 🔗 相关链接

- [插件GitHub仓库](https://github.com/lxfight/astrbot_plugin_knowledge_base)
- [AstrBot官方文档](https://docs.astrbot.app/)
- [QQ交流群](https://qm.qq.com/cgi-bin/qm/qr?k=xxx&jump_from=webapi&authKey=xxx)

---

**总结**：这个批量处理工具完全兼容 `astrbot_plugin_knowledge_base` 插件，可以帮您高效处理7G的PDF文件，避免手动上传的麻烦！🎉 